<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pendaftaran Anggota GOPAN Super</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
/* ===== Reset & Body ===== */
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #e6f7ff, #ffffff);
  color: #003f80;
  padding: 20px;
}

/* ===== Wrapper ===== */
.wrapper {
  background: #ffffffcc; /* sedikit transparan */
  padding: 25px 30px;
  border-radius: 25px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.08);
  max-width: 1200px;
  margin: 0 auto;
  backdrop-filter: blur(12px);
}

/* ===== Judul Halaman ===== */
h1 {
  text-align: center;
  font-family: 'Playfair Display', serif;
  font-size: 2.6em;
  font-weight: 700;
  margin-bottom: 25px;
  color: #003f80;
  letter-spacing: 1px;
  text-shadow: 0px 2px 6px rgba(0,0,0,0.15);
}

/* ===== Formulir ===== */
form {
  max-width: 600px;
  margin: auto;
  background: #ffffffee;
  padding: 35px 30px;
  border-radius: 25px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.12);
  border: 1px solid rgba(0,0,0,0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
form:hover {
  transform: translateY(-4px);
  box-shadow: 0 30px 60px rgba(0,0,0,0.18);
}

/* ===== Input & Select ===== */
input, select, textarea {
  width: 100%;
  padding: 14px 16px;
  margin: 12px 0;
  border-radius: 14px;
  border: 1px solid #4fa3ff;
  font-size: 15px;
  background: #ffffffee;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);
  transition: all 0.3s;
}
input:focus, select:focus, textarea:focus {
  border-color: #003f80;
  box-shadow: 0 0 10px rgba(0,63,128,0.3);
  outline: none;
}

/* ===== Tombol ===== */
button {
  padding: 12px 18px;
  border: none;
  border-radius: 14px;
  cursor: pointer;
  font-weight: 600;
  font-size: 15px;
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
button.submit { 
  background: linear-gradient(135deg, #003f80, #4fa3ff); 
  color: #fff; width:100%; 
}
button.submit:hover { 
  background: linear-gradient(135deg, #004da6, #66b3ff);
  transform: translateY(-3px); 
  box-shadow: 0 12px 25px rgba(0,63,128,0.5); 
}

/* ===== Stats Box ===== */
.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 20px;
  margin: 25px auto;
  max-width: 1100px;
}
.stats div {
  background: linear-gradient(135deg, #003f80, #4fa3ff);
  padding: 25px;
  border-radius: 20px;
  text-align: center;
  font-weight: 600;
  color: #ffffff;
  transition: all 0.3s;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}
.stats div:hover {
  background: linear-gradient(135deg, #004da6, #66b3ff);
  transform: translateY(-5px);
  box-shadow: 0 18px 35px rgba(0,63,128,0.4);
}
.stats div span {
  display:block;
  font-size: 2.4em;
  font-weight: 700;
  margin-bottom: 8px;
}

/* ===== Table ===== */
.table-container {
  overflow-x: auto;
  margin: 25px auto;
  max-width: 1100px;
}
table {
  width: 100%;
  border-collapse: collapse;
  background: #ffffff;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 18px 40px rgba(0,0,0,0.1);
}
th {
  padding: 14px;
  text-align: center;
  background: linear-gradient(135deg, #003f80, #4fa3ff);
  font-weight: 700;
  color: #ffffff;
  cursor: pointer;
}
td {
  padding: 14px;
  text-align: center;
  color: #003f80;
  border-bottom: 1px solid rgba(0,0,0,0.05);
}
tr:hover td { 
  background: #f0f8ff; 
}

/* ===== Status Badge ===== */
.status-selesai { 
  background: linear-gradient(135deg, #28a745, #5cd65c);
  padding: 6px 12px;
  border-radius: 12px;
  color:#fff;
  font-weight: 600;
}
.status-proses { 
  background: linear-gradient(135deg, #ff9933, #ffcc66);
  padding: 6px 12px;
  border-radius: 12px;
  color:#fff;
  font-weight: 600;
}
.status-pending { 
  background: linear-gradient(135deg, #4fa3ff, #99ccff);
  padding: 6px 12px;
  border-radius: 12px;
  color:#003f80;
  font-weight: 600;
}

.modal {
  display: none; 
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 0;
  transition: opacity 0.3s ease;
}
.modal.show {
  display: flex;
  opacity: 1;
}
.modal-content {
  background: #fff;
  padding: 20px 25px;
  border-radius: 12px;
  width: 350px;
  max-width: 90%;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  transform: translateY(-20px);
  transition: transform 0.3s ease;
}
.modal.show .modal-content {
  transform: translateY(0);
}
.modal-content h3 {
  margin-bottom: 15px;
  font-family: 'Poppins', sans-serif;
}
.modal-content input, .modal-content select {
  width: 100%;
  padding: 8px 10px;
  margin: 6px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
}
.modal-content button {
  padding: 8px 15px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
.modal-content .submit {
  background-color: #007bff;
  color: #fff;
  margin-right: 10px;
}
.modal-content button:hover {
  opacity: 0.9;
}

 </style>
</head>
<body>

  <h1>Pendaftaran Anggota GOPAN</h1>

  <!-- ===== Formulir Pendaftaran ===== -->
  <form id="anggotaForm">
    <input type="text" id="nama" placeholder="Nama Lengkap" required>
    <input type="tel" id="hp" placeholder="No HP (10-13 digit)" required>
    <input type="text" id="domisili" placeholder="Domisili Kandang" required>
    <input type="number" id="populasi" placeholder="Populasi" min="1" required>
    <select id="statusKandang" required>
      <option value="">-- Status Kandang --</option>
      <option value="sendiri">Sendiri</option>
      <option value="sewa">Sewa</option>
    </select>
    <button type="submit" class="submit">Daftar</button>
  </form>

  <!-- ===== Pencarian & Filter ===== -->
  <div class="search-container">
    <input type="text" id="search" placeholder="Cari nama/domisi...">
    <select id="filterStatus">
      <option value="">Semua Status</option>
      <option value="sendiri">Sendiri</option>
      <option value="sewa">Sewa</option>
    </select>
    <select id="filterPendaftaran">
      <option value="">Semua Pendaftaran</option>
      <option value="pending">Pending</option>
      <option value="diterima">Diterima</option>
      <option value="ditolak">Ditolak</option>
    </select>
    <button class="export" onclick="exportCSV()">Export CSV</button>
    <input type="file" id="importCSV" accept=".csv">
    <button class="reset" onclick="resetAll()">Reset Data</button>
    <button class="undo" onclick="undoLast()">Undo Terakhir</button>
  </div>

  <!-- ===== Statistik ===== -->
  <div class="stats">
    <div>Total Anggota: <span id="total">0</span></div>
    <div>Kandang Sendiri: <span id="sendiri">0</span></div>
    <div>Kandang Sewa: <span id="sewa">0</span></div>
    <div>Total Populasi: <span id="totalPopulasi">0</span></div>
  </div>

  <!-- ===== Tabel Anggota ===== -->
  <table>
    <thead>
      <tr>
        <th onclick="sortTable('nama')">Nama &#x25B2;&#x25BC;</th>
        <th>No HP</th>
        <th>Domisili</th>
        <th onclick="sortTable('populasi')">Populasi &#x25B2;&#x25BC;</th>
        <th>Status Kandang</th>
        <th>Status Pendaftaran</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="anggotaList"></tbody>
  </table>

  <!-- ===== Pagination ===== -->
  <div class="pagination" id="pagination"></div>

  <!-- ===== Modal Edit Anggota ===== -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3>Edit Anggota</h3>
      <input type="text" id="editNama" placeholder="Nama Lengkap">
      <input type="tel" id="editHp" placeholder="No HP">
      <input type="text" id="editDomisili" placeholder="Domisili Kandang">
      <input type="number" id="editPopulasi" placeholder="Populasi" min="1">
      <select id="editStatusKandang">
        <option value="">-- Status Kandang --</option>
        <option value="sendiri">Sendiri</option>
        <option value="sewa">Sewa</option>
      </select>
      <button onclick="saveEdit()" class="submit">Simpan</button>
      <button onclick="closeModal()">Batal</button>
    </div>
  </div>

<script>
let anggotaList = [], undoStack = [], currentEditIndex = null, currentPage = 1, perPage = 5;

// ===== Load Data dari localStorage =====
function loadData() {
  const data = JSON.parse(localStorage.getItem('anggotaList') || '[]');
  anggotaList = data.map(a => ({
    id: a.id,
    nama: a.nama,
    hp: a.hp,
    domisili: a.domisili,
    populasi: parseInt(a.populasi),
    statusKandang: a.statusKandang || '',
    statusPendaftaran: a.statusPendaftaran || 'pending'
  }));
  renderTable();
}

// ===== Simpan Data ke localStorage =====
function saveData() {
  localStorage.setItem('anggotaList', JSON.stringify(anggotaList));
}

// ===== Render Table =====
function renderTable() {
  const tbody = document.getElementById("anggotaList");
  tbody.innerHTML = "";

  const searchText = document.getElementById("search").value.toLowerCase();
  const filterStatus = document.getElementById("filterStatus").value.toLowerCase();
  const filterP = document.getElementById("filterPendaftaran").value.toLowerCase();

  let filtered = anggotaList.filter(a =>
    (a.nama.toLowerCase().includes(searchText) || a.domisili.toLowerCase().includes(searchText)) &&
    (filterStatus === "" || a.statusKandang.toLowerCase() === filterStatus) &&
    (filterP === "" || a.statusPendaftaran.toLowerCase() === filterP)
  );

  const totalPage = Math.ceil(filtered.length / perPage);
  if(currentPage > totalPage) currentPage = totalPage || 1;
  const start = (currentPage-1)*perPage;
  const pageItems = filtered.slice(start, start+perPage);

  pageItems.forEach(a => {
    const tr = document.createElement("tr");
    tr.className = `status-${a.statusPendaftaran.toLowerCase()}`;
    tr.innerHTML = `
      <td><a href="#" onclick="showDetail(${a.id})">${a.nama}</a></td>
      <td>${a.hp}</td>
      <td>${a.domisili}</td>
      <td>${a.populasi}</td>
      <td>${a.statusKandang}</td>
      <td>${a.statusPendaftaran}</td>
      <td>
        <button onclick="editAnggota(${a.id})">Edit</button>
        <button onclick="deleteAnggota(${a.id})">Hapus</button>
        ${a.statusPendaftaran.toLowerCase() === 'pending' ? `<button onclick="approve(${a.id})">Terima</button>
        <button onclick="reject(${a.id})">Tolak</button>` : ''}
      </td>`;
    tbody.appendChild(tr);
  });

  renderPagination(totalPage);
  renderStats();
}

// ===== Pagination =====
function renderPagination(totalPage) {
  const container = document.getElementById("pagination");
  container.innerHTML = "";
  for(let i=1; i<=totalPage; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    if(i === currentPage) btn.classList.add("active");
    btn.onclick = () => { currentPage = i; renderTable(); }
    container.appendChild(btn);
  }
}

// ===== Render Stats =====
function renderStats() {
  const total = anggotaList.length;
  const sendiri = anggotaList.filter(a => a.statusKandang.toLowerCase() === 'sendiri').length;
  const sewa = anggotaList.filter(a => a.statusKandang.toLowerCase() === 'sewa').length;
  const totalPopulasi = anggotaList.reduce((sum, a) => sum + (a.populasi || 0), 0);

  document.getElementById("total").textContent = total;
  document.getElementById("sendiri").textContent = sendiri;
  document.getElementById("sewa").textContent = sewa;
  document.getElementById("totalPopulasi").textContent = totalPopulasi;
}

// ===== Tambah Anggota =====
document.getElementById("anggotaForm").addEventListener("submit", e => {
  e.preventDefault();
  const data = {
    id: Date.now(),
    nama: document.getElementById("nama").value.trim(),
    hp: document.getElementById("hp").value.trim(),
    domisili: document.getElementById("domisili").value.trim(),
    populasi: parseInt(document.getElementById("populasi").value),
    statusKandang: document.getElementById("statusKandang").value,
    statusPendaftaran: 'pending'
  };

  if(data.nama.length < 3){ alert("Nama minimal 3 huruf!"); return; }
  if(!/^\d{10,13}$/.test(data.hp)){ alert("HP harus 10-13 digit!"); return; }
  if(data.populasi < 1){ alert("Populasi minimal 1!"); return; }
  if(!data.statusKandang){ alert("Pilih status kandang!"); return; }

  anggotaList.push(data);
  undoStack.push({action:'add',id:data.id});
  saveData();
  loadData();
  document.getElementById("anggotaForm").reset();
});

// ===== Edit =====
function editAnggota(id) {
  const anggota = anggotaList.find(a => a.id == id);
  if(!anggota) return;

  document.getElementById("editNama").value = anggota.nama;
  document.getElementById("editHp").value = anggota.hp;
  document.getElementById("editDomisili").value = anggota.domisili;
  document.getElementById("editPopulasi").value = anggota.populasi;
  document.getElementById("editStatusKandang").value = anggota.statusKandang;

  document.getElementById("modal").classList.add("show");
  currentEditIndex = id;
}

function saveEdit() {
  if(currentEditIndex === null) return;
  const anggota = anggotaList.find(a => a.id == currentEditIndex);
  if(!anggota) return;

  const prev = {...anggota};
  anggota.nama = document.getElementById("editNama").value.trim();
  anggota.hp = document.getElementById("editHp").value.trim();
  anggota.domisili = document.getElementById("editDomisili").value.trim();
  anggota.populasi = parseInt(document.getElementById("editPopulasi").value);
  anggota.statusKandang = document.getElementById("editStatusKandang").value;

  undoStack.push({action:'edit',prev});
  saveData();
  closeModal();
  loadData();
}

function closeModal() {
  document.getElementById("modal").classList.remove("show");
  currentEditIndex = null;
}

// ===== Delete =====
function deleteAnggota(id) {
  const anggota = anggotaList.find(a => a.id == id);
  if(!anggota) return;
  if(!confirm("Hapus anggota ini?")) return;

  undoStack.push({action:'delete',data:{...anggota}});
  anggotaList = anggotaList.filter(a => a.id != id);
  saveData();
  loadData();
}

// ===== Approve / Reject =====
function approve(id){ updateStatus(id,'diterima'); }
function reject(id){ updateStatus(id,'ditolak'); }

function updateStatus(id,status){
  const anggota = anggotaList.find(a => a.id == id);
  if(!anggota) return;

  undoStack.push({action:'status',id,status:anggota.statusPendaftaran});
  anggota.statusPendaftaran = status;
  saveData();
  loadData();
}

// ===== Undo =====
function undoLast() {
  if(!undoStack.length){ alert("Tidak ada aksi untuk di-undo!"); return; }
  const last = undoStack.pop();

  switch(last.action) {
    case 'add':
      anggotaList = anggotaList.filter(a => a.id != last.id);
      break;
    case 'delete':
      anggotaList.push(last.data);
      break;
    case 'edit':
      const idx = anggotaList.findIndex(a=>a.id==last.prev.id);
      if(idx!==-1) anggotaList[idx] = last.prev;
      break;
    case 'status':
      const a = anggotaList.find(a=>a.id==last.id);
      if(a) a.statusPendaftaran = last.status;
      break;
  }
  saveData();
  loadData();
}

// ===== Reset Semua =====
function resetAll(){
  if(!confirm("Reset semua data?")) return;
  undoStack.push({action:'reset',prev:[...anggotaList]});
  anggotaList = [];
  saveData();
  loadData();
}

// ===== Show Detail =====
function showDetail(id){
  const a = anggotaList.find(a=>a.id==id);
  if(!a) return;
  alert(`Nama: ${a.nama}\nHP: ${a.hp}\nDomisili: ${a.domisili}\nPopulasi: ${a.populasi}\nStatus Kandang: ${a.statusKandang}\nStatus Pendaftaran: ${a.statusPendaftaran}`);
}

// ===== Filter / Search =====
document.getElementById("search").addEventListener("input", renderTable);
document.getElementById("filterStatus").addEventListener("change", renderTable);
document.getElementById("filterPendaftaran").addEventListener("change", renderTable);

// ===== Load Awal =====
loadData();
</script>



</body>
</html>
